-- ============================================
-- NIGHT CRIMSON HUB v0.1 - TRANSPLANTE BRUTO
-- ============================================

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")

-- CONFIGURAÃ‡ÃƒO ORIGINAL DO SCRIPT
local CONFIG = {
    VIEW_DISTANCE = 12,
    VIEW_HEIGHT = 4,
    SMOOTHNESS = 0.08,
    TELEPORT_HEIGHT = 5,
    FLING_SPEED = 250
}

-- VARIÃVEIS DE ESTADO ORIGINAIS
local isViewing = false
local isFlinging = false
local isNoclipping = false
local isFlying = false
local targetPlayer = nil
local originalCameraType = nil
local originalCameraSubject = nil
local originalWalkSpeed = 16
local originalJumpPower = 50
local noclipConnection = nil
local flingGyro = nil
local flySpeed = 50

-- CORES DA GUI NC
local MAIN_COLOR = Color3.fromRGB(40, 0, 0)
local HOVER_COLOR = Color3.fromRGB(60, 0, 0)

-- SCREEN GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NightCrimsonHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Suporte para executores
if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
else
    ScreenGui.Parent = game.CoreGui
end

-- BOTÃƒO PRINCIPAL (NC)
local MainButton = Instance.new("TextButton")
MainButton.Name = "MainButton"
MainButton.Size = UDim2.new(0, 35, 0, 35)
MainButton.Position = UDim2.new(1, -50, 0, 20)
MainButton.AnchorPoint = Vector2.new(1, 0)
MainButton.BackgroundColor3 = MAIN_COLOR
MainButton.Text = "NC"
MainButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MainButton.Font = Enum.Font.SourceSansBold
MainButton.TextSize = 14
MainButton.ZIndex = 1000
MainButton.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0)
UICorner.Parent = MainButton

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(0, 0, 0)
UIStroke.Thickness = 1.5
UIStroke.Parent = MainButton

-- TAG DE NOME (NightCrimson Hub v0.1)
local NameTag = Instance.new("Frame")
NameTag.Name = "NameTag"
NameTag.Size = UDim2.new(0, 0, 0, 30)
NameTag.Position = UDim2.new(1, -50, 0, 20)
NameTag.AnchorPoint = Vector2.new(1, 0)
NameTag.BackgroundColor3 = MAIN_COLOR
NameTag.BackgroundTransparency = 0.3
NameTag.Visible = false
NameTag.ZIndex = 999
NameTag.Parent = ScreenGui

local NameLabel = Instance.new("TextLabel")
NameLabel.Size = UDim2.new(1, -10, 1, 0)
NameLabel.Position = UDim2.new(0, 5, 0, 0)
NameLabel.BackgroundTransparency = 1
NameLabel.Text = "ðŸŒ‘ NightCrimson Hub v0.1"
NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NameLabel.Font = Enum.Font.SourceSansBold
NameLabel.TextSize = 12
NameLabel.TextXAlignment = Enum.TextXAlignment.Left
NameLabel.Parent = NameTag

-- BARRA DE COMANDOS
local CommandFrame = Instance.new("Frame")
CommandFrame.Name = "CommandFrame"
CommandFrame.Size = UDim2.new(0, 0, 0, 40)
CommandFrame.Position = UDim2.new(1, -20, 1, -30)
CommandFrame.AnchorPoint = Vector2.new(1, 1)
CommandFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
CommandFrame.BackgroundTransparency = 0.15
CommandFrame.Visible = false
CommandFrame.Parent = ScreenGui

local CommandBox = Instance.new("TextBox")
CommandBox.Size = UDim2.new(1, -10, 1, 0)
CommandBox.Position = UDim2.new(0, 5, 0, 0)
CommandBox.BackgroundTransparency = 1
CommandBox.PlaceholderText = "Digite comando..."
CommandBox.TextColor3 = Color3.fromRGB(255, 255, 255)
CommandBox.TextSize = 14
CommandBox.Font = Enum.Font.SourceSans
CommandBox.TextXAlignment = Enum.TextXAlignment.Left
CommandBox.Text = ""
CommandBox.Parent = CommandFrame

-- SISTEMA DE ARRASTAR (DRAG)
local dragging, dragInput, dragStart, startPos
MainButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainButton.Position
    end
end)
UIS.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        NameTag.Position = MainButton.Position
    end
end)
UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)
-- ============================================
-- FUNÃ‡Ã•ES PRINCIPAIS (TRANSPLANTE BRUTO)
-- ============================================

local function findPlayerByName(name)
    if not name or name == "" then return nil end
    name = string.lower(name:gsub("%s+$", ""))
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player then
            if string.lower(player.DisplayName) == name or
               string.lower(player.Name) == name then
                return player
            end
            if string.find(string.lower(player.DisplayName), name) or
               string.find(string.lower(player.Name), name) then
                return player
            end
        end
    end
    return nil
end

-- SISTEMA VIEW ORIGINAL
local function startViewing(player)
    if not player or player == Player then return false end
    originalCameraType = Workspace.CurrentCamera.CameraType
    originalCameraSubject = Workspace.CurrentCamera.CameraSubject
    Workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
    isViewing = true
    targetPlayer = player
    return true
end

local function stopViewing()
    if not isViewing then return end
    Workspace.CurrentCamera.CameraType = originalCameraType or Enum.CameraType.Custom
    Workspace.CurrentCamera.CameraSubject = originalCameraSubject or Player.Character and Player.Character:FindFirstChild("Humanoid")
    isViewing = false
    targetPlayer = nil
end

local function updateCamera()
    if not isViewing or not targetPlayer then return end
    local targetCharacter = targetPlayer.Character
    if not targetCharacter then stopViewing() return end
    local humanoidRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then stopViewing() return end
    
    local lookVector = humanoidRootPart.CFrame.LookVector
    local upVector = Vector3.new(0, 1, 0)
    local offsetPosition = humanoidRootPart.Position - (lookVector * CONFIG.VIEW_DISTANCE) + (upVector * CONFIG.VIEW_HEIGHT)
    local lookAtPosition = humanoidRootPart.Position + (upVector * 2)
    local currentCFrame = Workspace.CurrentCamera.CFrame
    local targetCFrame = CFrame.lookAt(offsetPosition, lookAtPosition)
    Workspace.CurrentCamera.CFrame = currentCFrame:Lerp(targetCFrame, CONFIG.SMOOTHNESS)
end

-- SISTEMA GOTO ORIGINAL
local function teleportToPlayer(player)
    if not player or player == Player then return false end
    local targetCharacter = player.Character
    local humanoidRootPart = targetCharacter and targetCharacter:FindFirstChild("HumanoidRootPart")
    local myCharacter = Player.Character
    local myHumanoidRootPart = myCharacter and myCharacter:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart or not myHumanoidRootPart then return false end
    
    local lookVector = humanoidRootPart.CFrame.LookVector
    local teleportPosition = humanoidRootPart.Position - (lookVector * 4) + Vector3.new(0, CONFIG.TELEPORT_HEIGHT, 0)
    myHumanoidRootPart.CFrame = CFrame.new(teleportPosition)
    return true
end

-- SISTEMA FLING ORIGINAL
local function startFling()
    if isFlinging then return false end
    local myCharacter = Player.Character
    local myHumanoidRootPart = myCharacter and myCharacter:FindFirstChild("HumanoidRootPart")
    if not myHumanoidRootPart then return false end
    isFlinging = true
    flingGyro = Instance.new("BodyGyro")
    flingGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    flingGyro.P = 100000
    flingGyro.D = 1000
    flingGyro.CFrame = myHumanoidRootPart.CFrame
    flingGyro.Parent = myHumanoidRootPart
    spawn(function()
        while isFlinging and flingGyro and flingGyro.Parent do
            flingGyro.CFrame = flingGyro.CFrame * CFrame.Angles(0, math.rad(CONFIG.FLING_SPEED), 0)
            RunService.RenderStepped:Wait()
        end
    end)
    return true
end

local function stopFling()
    isFlinging = false
    if flingGyro then flingGyro:Destroy() flingGyro = nil end
end

-- SISTEMA FLY ORIGINAL
local function startFly(speed)
    if isFlying then return false end
    local myCharacter = Player.Character
    local torso = myCharacter and myCharacter:FindFirstChild("HumanoidRootPart")
    if not torso then return false end
    isFlying = true
    if speed then flySpeed = math.clamp(tonumber(speed) or 50, 1, 1000) end
    local hum = myCharacter:FindFirstChildOfClass("Humanoid")
    if hum then hum.PlatformStand = true end

    local bg = Instance.new("BodyGyro", torso)
    bg.P = 500
    bg.D = 50
    bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
    local bv = Instance.new("BodyVelocity", torso)
    bv.velocity = Vector3.new(0, 0, 0)
    bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
    local lastCameraCF = workspace.CurrentCamera.CFrame

    spawn(function()
        repeat
            RunService.RenderStepped:Wait()
            if not isFlying or not torso or not torso.Parent then break end
            if hum then hum.PlatformStand = true end
            -- Movimento baseado no LookVector da Camera (Substituindo Joystick)
            bv.velocity = workspace.CurrentCamera.CFrame.LookVector * flySpeed
            local currentCameraCF = workspace.CurrentCamera.CFrame
            if (currentCameraCF.Position - lastCameraCF.Position).Magnitude > 0.01 or
               currentCameraCF.LookVector:Dot(lastCameraCF.LookVector) < 0.999 then
                bg.cframe = currentCameraCF
                lastCameraCF = currentCameraCF
            end
        until not isFlying
        if bg then bg:Destroy() end
        if bv then bv:Destroy() end
        if myCharacter and myCharacter:FindFirstChildOfClass("Humanoid") then
            myCharacter:FindFirstChildOfClass("Humanoid").PlatformStand = false
        end
    end)
    return true
end

local function stopFly()
    isFlying = false
end

-- SISTEMA NOCLIP ORIGINAL
local function startNoclip()
    if isNoclipping then return false end
    isNoclipping = true
    noclipConnection = RunService.Stepped:Connect(function()
        if not isNoclipping or not Player.Character then
            if noclipConnection then noclipConnection:Disconnect() noclipConnection = nil end
            return
        end
        for _, part in ipairs(Player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end)
    return true
end

local function stopNoclip()
    isNoclipping = false
    if noclipConnection then noclipConnection:Disconnect() noclipConnection = nil end
    if Player.Character then
        for _, part in ipairs(Player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
        end
    end
end
-- ============================================
-- SISTEMA SPEED E JUMP (ORIGINAL)
-- ============================================

local function setSpeed(value)
    local myCharacter = Player.Character
    local humanoid = myCharacter and myCharacter:FindFirstChild("Humanoid")
    if not humanoid then return false end
    if originalWalkSpeed == 16 then originalWalkSpeed = humanoid.WalkSpeed end
    local speed = tonumber(value)
    if not speed or speed < 0 or speed > 1000 then return false end
    humanoid.WalkSpeed = speed
    return true
end

local function resetSpeed()
    local myCharacter = Player.Character
    local humanoid = myCharacter and myCharacter:FindFirstChild("Humanoid")
    if humanoid then humanoid.WalkSpeed = originalWalkSpeed end
end

local function setJump(value)
    local myCharacter = Player.Character
    local humanoid = myCharacter and myCharacter:FindFirstChild("Humanoid")
    if not humanoid then return false end
    if originalJumpPower == 50 then originalJumpPower = humanoid.JumpPower end
    local jump = tonumber(value)
    if not jump or jump < 0 or jump > 1000 then return false end
    humanoid.JumpPower = jump
    return true
end

local function resetJump()
    local myCharacter = Player.Character
    local humanoid = myCharacter and myCharacter:FindFirstChild("Humanoid")
    if humanoid then humanoid.JumpPower = originalJumpPower end
end

-- REJOIN E SERVER HOP (ORIGINAL)
local function rejoinServer()
    TeleportService:Teleport(game.PlaceId, Player)
end

local function serverHop()
    local HttpService = game:GetService("HttpService")
    local Api = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
    local function NextServer(cursor)
        local res = game:HttpGet(Api .. (cursor and "&cursor=" .. cursor or ""))
        local data = HttpService:JSONDecode(res)
        for _, v in pairs(data.data) do
            if v.playing < v.maxPlayers and v.id ~= game.JobId then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, v.id)
                return
            end
        end
        if data.nextPageCursor then NextServer(data.nextPageCursor) end
    end
    NextServer()
end

-- ============================================
-- PROCESSADOR DE COMANDOS (EXATO)
-- ============================================

local function executeCommand(input)
    if not input or input == "" then return end
    local command = string.lower(input)
    
    if string.sub(command, 1, 5) == "view " then
        local target = findPlayerByName(string.sub(input, 6))
        if target then startViewing(target) end
    elseif command == "unview" then
        stopViewing()
    elseif string.sub(command, 1, 5) == "goto " then
        local target = findPlayerByName(string.sub(input, 6))
        if target then teleportToPlayer(target) end
    elseif command == "fling" then
        startFling()
    elseif command == "unfling" then
        stopFling()
    elseif string.sub(command, 1, 4) == "fly " then
        startFly(string.sub(input, 5))
    elseif command == "fly" then
        startFly()
    elseif command == "unfly" then
        stopFly()
    elseif command == "noclip" then
        startNoclip()
    elseif command == "unnoclip" then
        stopNoclip()
    elseif string.sub(command, 1, 6) == "speed " then
        setSpeed(string.sub(input, 7))
    elseif command == "unspeed" then
        resetSpeed()
    elseif string.sub(command, 1, 5) == "jump " then
        setJump(string.sub(input, 6))
    elseif command == "unjump" then
        resetJump()
    elseif command == "rejoin" or command == "rj" then
        rejoinServer()
    elseif command == "serverhop" or command == "sh" then
        serverHop()
    end
    
    CommandBox.Text = ""
end

-- ============================================
-- INTERAÃ‡Ã•ES DA GUI NC
-- ============================================

local function openCommandBar()
    CommandFrame.Visible = true
    MainButton.Text = "ðŸŒ‘"
    TweenService:Create(CommandFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 300, 0, 40),
        Position = UDim2.new(1, -320, 1, -60)
    }):Play()
    task.wait(0.1)
    CommandBox:CaptureFocus()
end

local function closeCommandBar()
    local tween = TweenService:Create(CommandFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 40),
        Position = UDim2.new(1, -20, 1, -30)
    })
    tween:Play()
    tween.Completed:Connect(function()
        CommandFrame.Visible = false
        MainButton.Text = "NC"
    end)
end

MainButton.MouseButton1Click:Connect(function()
    if CommandFrame.Visible then closeCommandBar() else openCommandBar() end
end)

MainButton.MouseEnter:Connect(function()
    NameTag.Visible = true
    TweenService:Create(NameTag, TweenInfo.new(0.3, Enum.EasingStyle.Back), {
        Size = UDim2.new(0, 170, 0, 30),
        Position = UDim2.new(1, -175, 0, 20)
    }):Play()
end)

MainButton.MouseLeave:Connect(function()
    TweenService:Create(NameTag, TweenInfo.new(0.2), {
        Size = UDim2.new(0, 0, 0, 30),
        Position = UDim2.new(1, -50, 0, 20)
    }):Play()
    task.wait(0.2)
    NameTag.Visible = false
end)

CommandBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then executeCommand(CommandBox.Text) end
    task.wait(0.1)
    if CommandBox.Text == "" then closeCommandBar() end
end)

RunService.RenderStepped:Connect(updateCamera)

print("ðŸŒ‘ NightCrimson Hub v0.1 Pronto!")
