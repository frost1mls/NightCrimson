-- ============================================
-- NIGHT CRIMSON HUB v2.0 - PC & MOBILE
-- GUI Moderno com Bot√£o M√≥vel e Auto-fechamento
-- Baseado no Ryuzen Hub original
-- ============================================

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")

-- ============================================
-- CONFIGURA√á√ÉO
-- ============================================
local CONFIG = {
    VIEW_DISTANCE = 12,
    VIEW_HEIGHT = 4,
    SMOOTHNESS = 0.08,
    TELEPORT_HEIGHT = 5,
    FLING_SPEED = 250
}

-- ============================================
-- DETECTAR PLATAFORMA
-- ============================================
local isMobile = UserInputService.TouchEnabled
local isDesktop = UserInputService.KeyboardEnabled

-- ============================================
-- VARI√ÅVEIS
-- ============================================
local isViewing = false
local isFlinging = false
local isNoclipping = false
local isFlying = false
local targetPlayer = nil
local originalCameraType = nil
local originalCameraSubject = nil
local originalWalkSpeed = 16
local originalJumpPower = 50
local noclipConnection = nil
local flingGyro = nil

-- Sistema FLY (ORIGINAL DO RYUZEN)
local flySpeed = 50
local flyJoystickDir = Vector2.new(0, 0)
local flyAltitude = 0
local flyJoystickTouch = nil
local flyJoystickCenter = Vector2.new(150, 450)
local flyJoystickRadius = 80
local flyAltitudeTouch = nil

-- ============================================
-- GUI NIGHT CRIMSON (MODERNO)
-- ============================================

-- VERMELHO ESCURO M√ÅXIMO
local MAIN_COLOR = Color3.fromRGB(40, 0, 0)
local HOVER_COLOR = Color3.fromRGB(60, 0, 0)

-- SCREEN GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NightCrimsonHub"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = game.CoreGui
end

-- BOT√ÉO PRINCIPAL (NC)
local MainButton = Instance.new("TextButton")
MainButton.Name = "MainButton"
MainButton.Size = UDim2.new(0, 35, 0, 35)
MainButton.Position = UDim2.new(1, -50, 0, 20)
MainButton.AnchorPoint = Vector2.new(1, 0)
MainButton.BackgroundColor3 = MAIN_COLOR
MainButton.Text = "NC"
MainButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MainButton.TextSize = 14
MainButton.Font = Enum.Font.SourceSansBold
MainButton.Active = true
MainButton.AutoButtonColor = true
MainButton.Visible = true
MainButton.ZIndex = 1000

-- PERFEITAMENTE REDONDO
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0)
UICorner.Parent = MainButton

-- Borda preta fina
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(0, 0, 0)
UIStroke.Thickness = 1.5
UIStroke.Parent = MainButton

MainButton.Parent = ScreenGui

-- RET√ÇNGULO COM NOME (vis√≠vel no hover)
local NameTag = Instance.new("Frame")
NameTag.Name = "NameTag"
NameTag.Size = UDim2.new(0, 0, 0, 30)
NameTag.Position = UDim2.new(1, -50, 0, 20)
NameTag.AnchorPoint = Vector2.new(1, 0)
NameTag.BackgroundColor3 = MAIN_COLOR
NameTag.BackgroundTransparency = 0.3
NameTag.BorderSizePixel = 0
NameTag.Visible = false
NameTag.ZIndex = 999

local NameTagCorner = Instance.new("UICorner")
NameTagCorner.CornerRadius = UDim.new(0, 6)
NameTagCorner.Parent = NameTag

local NameTagStroke = Instance.new("UIStroke")
NameTagStroke.Color = Color3.fromRGB(0, 0, 0)
NameTagStroke.Thickness = 1
NameTagStroke.Parent = NameTag

local NameLabel = Instance.new("TextLabel")
NameLabel.Name = "NameLabel"
NameLabel.Size = UDim2.new(1, -10, 1, 0)
NameLabel.Position = UDim2.new(0, 5, 0, 0)
NameLabel.BackgroundTransparency = 1
NameLabel.Text = "üåë Night Crimson Hub v2.0"
NameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
NameLabel.TextSize = 12
NameLabel.Font = Enum.Font.SourceSansBold
NameLabel.TextXAlignment = Enum.TextXAlignment.Left
NameLabel.ZIndex = 1000
NameLabel.Parent = NameTag

NameTag.Parent = ScreenGui

-- BARRA DE COMANDO
local CommandFrame = Instance.new("Frame")
CommandFrame.Name = "CommandFrame"
CommandFrame.Size = UDim2.new(0, 300, 0, 40)
CommandFrame.Position = UDim2.new(1, -320, 1, -60)
CommandFrame.AnchorPoint = Vector2.new(1, 1)
CommandFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
CommandFrame.BackgroundTransparency = 0.15
CommandFrame.BorderSizePixel = 0
CommandFrame.Visible = false
CommandFrame.Active = true
CommandFrame.ZIndex = 999

local CommandCorner = Instance.new("UICorner")
CommandCorner.CornerRadius = UDim.new(0, 8)
CommandCorner.Parent = CommandFrame

local CommandBox = Instance.new("TextBox")
CommandBox.Name = "CommandBox"
CommandBox.Size = UDim2.new(1, -10, 1, 0)
CommandBox.Position = UDim2.new(0, 5, 0, 0)
CommandBox.BackgroundTransparency = 1
CommandBox.Text = ""
CommandBox.PlaceholderText = "Type commands here..."
CommandBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
CommandBox.TextColor3 = Color3.fromRGB(255, 255, 255)
CommandBox.TextSize = 14
CommandBox.Font = Enum.Font.SourceSans
CommandBox.TextXAlignment = Enum.TextXAlignment.Left
CommandBox.ClearTextOnFocus = false
CommandBox.ZIndex = 1000
CommandBox.Parent = CommandFrame

CommandFrame.Parent = ScreenGui

-- ============================================
-- VARI√ÅVEIS DO GUI
-- ============================================
local CommandOpen = false
local DraggingButton = false
local ButtonDragStart, ButtonStartPos
local AutoCloseTimer = nil

-- ============================================
-- FUN√á√ïES DO GUI
-- ============================================
local function showNameTag()
    NameTag.Visible = true
    NameTag.Size = UDim2.new(0, 0, 0, 30)
    NameTag.Position = UDim2.new(1, -50, 0, 20)
    
    TweenService:Create(NameTag, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 180, 0, 30),
        Position = UDim2.new(1, -185, 0, 20)
    }):Play()
end

local function hideNameTag()
    TweenService:Create(NameTag, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 30),
        Position = UDim2.new(1, -50, 0, 20)
    }):Play()
    
    task.wait(0.2)
    NameTag.Visible = false
end

local function openCommandBar()
    if CommandOpen then return end
    
    CommandOpen = true
    MainButton.Text = "üåë" -- Muda para lua quando aberto
    
    CommandFrame.Visible = true
    CommandFrame.Size = UDim2.new(0, 0, 0, 40)
    CommandFrame.Position = UDim2.new(1, -20, 1, -30)
    
    TweenService:Create(CommandFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 300, 0, 40),
        Position = UDim2.new(1, -320, 1, -60)
    }):Play()
    
    task.wait(0.15)
    CommandBox:CaptureFocus()
    
    if AutoCloseTimer then
        AutoCloseTimer:Disconnect()
    end
    
    AutoCloseTimer = CommandBox:GetPropertyChangedSignal("Text"):Connect(function()
        if AutoCloseTimer then
            AutoCloseTimer:Disconnect()
        end
        
        AutoCloseTimer = RunService.Heartbeat:Connect(function()
            task.wait(5)
            
            if CommandOpen and CommandBox.Text == "" then
                closeCommandBar()
            end
        end)
    end)
end

local function closeCommandBar()
    if not CommandOpen then return end
    
    CommandOpen = false
    MainButton.Text = "NC" -- Volta ao NC
    
    TweenService:Create(CommandFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 40),
        Position = UDim2.new(1, -20, 1, -30)
    }):Play()
    
    task.wait(0.2)
    CommandFrame.Visible = false
    CommandBox.Text = ""
    
    if AutoCloseTimer then
        AutoCloseTimer:Disconnect()
        AutoCloseTimer = nil
    end
end
